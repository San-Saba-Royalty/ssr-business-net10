# SSRBusiness .NET 10 Migration

This project is a modernized version of the legacy VB.NET 4.8 SSRBusiness library, migrated to **.NET 10 (LTS) with C#**.

## ğŸ¯ Migration Overview

### What Changed

| Aspect | Old (.NET Framework 4.8 VB) | New (.NET 10 C#) |
|--------|----------------------------|-----------------|
| **Language** | Visual Basic .NET | C# 14 |
| **Framework** | .NET Framework 4.8 | .NET 10 (LTS) |
| **Data Access** | LINQ to SQL | Entity Framework Core 10 |
| **Project Format** | Old-style .vbproj | SDK-style .csproj |
| **Async** | Synchronous methods | Async/await throughout |
| **Patterns** | Custom Business Objects | Repository Pattern |
| **Cross-platform** | Windows only | Windows, macOS, Linux |

### Key Benefits

âœ… **Cross-platform** - Runs on Mac, Linux, and Windows  
âœ… **Modern tooling** - VS Code, Rider, Visual Studio 2026  
âœ… **Better performance** - EF Core 10 is faster than LINQ to SQL  
âœ… **Active support** - .NET 10 LTS supported until Nov 2028  
âœ… **Async/await** - Better scalability and responsiveness  
âœ… **Nullable reference types** - Fewer null reference exceptions  
âœ… **C# 14 features** - Latest language enhancements  

## ğŸš€ Getting Started

### Prerequisites

- [.NET 8 SDK](https://dotnet.microsoft.com/download/dotnet/8.0)
- SQL Server (for the SanSaba database)
- IDE: VS Code, Rider, or Visual Studio

### Step 1: Update Connection String

Edit `appsettings.json` with your SQL Server credentials:

```json
{
  "ConnectionStrings": {
    "SanSabaConnection": "Server=YOUR_SERVER;Database=SanSaba;User Id=YOUR_USER;Password=YOUR_PASSWORD;TrustServerCertificate=True;"
  }
}
```

### Step 2: Scaffold Database Entities

The project includes a script to auto-generate all entity classes from your database:

```bash
chmod +x scaffold-database.sh
./scaffold-database.sh
```

This will:
- Install EF Core tools
- Connect to your database
- Generate all entity classes in `/Entities`
- Create the DbContext in `/Data`

### Step 3: Build the Project

```bash
dotnet restore
dotnet build
```

## ğŸ“ Project Structure

```
SSRBusiness.NET8/
â”œâ”€â”€ Data/
â”‚   â””â”€â”€ SsrDbContext.cs           # EF Core DbContext
â”œâ”€â”€ Entities/                     # Database entity classes
â”‚   â”œâ”€â”€ User.cs
â”‚   â”œâ”€â”€ UserRelatedEntities.cs
â”‚   â””â”€â”€ ... (generated by scaffold)
â”œâ”€â”€ BusinessClasses/              # Business logic repositories
â”‚   â””â”€â”€ UserRepository.cs
â”œâ”€â”€ BusinessFramework/            # Base repository pattern
â”‚   â””â”€â”€ Repository.cs
â”œâ”€â”€ Support/                      # Helper classes
â”‚   â”œâ”€â”€ SaltedHash.cs            # Password hashing
â”‚   â””â”€â”€ LookupListItem.cs        # Lookup DTOs
â”œâ”€â”€ SSRBusiness.csproj            # Modern SDK-style project
â”œâ”€â”€ appsettings.json             # Configuration
â””â”€â”€ scaffold-database.sh         # DB scaffolding script
```

## ğŸ”„ Migration Guide

### Converting VB Business Logic to C#

The original VB code followed this pattern:

```vb
' Old VB.NET
Public Class UserEntity
    Inherits SsrBusinessObject(Of User, SsrDataContext)
    
    Public Function LoadUserByUserID(ByVal userID As String) As User
        Me.Entity = Me.Context.Users.SingleOrDefault(Function(u) u.UserID = userID)
        Return Me.Entity
    End Function
End Class
```

The new C# uses repository pattern:

```csharp
// New C# .NET 8
public class UserRepository : Repository<User>
{
    public async Task<User?> LoadUserByUserIdAsync(string userId)
    {
        return await SingleOrDefaultAsync(u => u.UserId == userId);
    }
}
```

### Key Conversion Patterns

| VB.NET Pattern | C# Equivalent |
|----------------|---------------|
| `Function() As Type` | `async Task<Type> MethodAsync()` |
| `ByVal parameter As Type` | `Type parameter` |
| `Me.Entity` | Return directly or use local var |
| `Nothing` | `null` |
| `Function(u) u.Field` | `u => u.Field` |
| `Inherits SsrBusinessObject` | `: Repository<T>` |

### Example Conversions

#### 1. Simple Query
```vb
' VB
Public Function GetUserList() As IQueryable(Of User)
    Return From u In Context.Users _
           Order By u.UserName.ToUpper _
           Select u
End Function
```

```csharp
// C#
public async Task<List<User>> GetUserListAsync()
{
    return await DbSet
        .OrderBy(u => u.Email)
        .ToListAsync();
}
```

#### 2. Password Authentication
```vb
' VB
Public Function AuthenticateAndLoad(ByVal userName As String, _
                                   ByVal password As String) As User
    If Not LoadUserByUserName(userName) Is Nothing Then
        Dim ver As SaltedHash = SaltedHash.Create(Me.Entity.Salt, Me.Entity.Password)
        If ver.Verify(password) Then
            Return Me.Entity
        End If
    End If
    Return Nothing
End Function
```

```csharp
// C#
public async Task<User?> AuthenticateAndLoadAsync(string userName, string password)
{
    var user = await LoadUserByUserNameAsync(userName);
    
    if (user != null && AuthenticateUserCredentials(user, password))
    {
        user.LastLogin = DateTime.UtcNow;
        Update(user);
        await SaveChangesAsync();
        return user;
    }
    
    return null;
}
```

## ğŸ” Password Hashing

The `SaltedHash` class has been converted to C# with backward compatibility:

```csharp
// Creating new hash (compatible with old VB system)
var hash = SaltedHash.Create(password, useSha1ForCompatibility: true);

// Verifying password
var isValid = hash.Verify(inputPassword);
```

âš ï¸ **Important**: Set `useSha1ForCompatibility: true` to work with existing passwords from the VB system.

## ğŸ“Š Using the Repository Pattern

### Basic CRUD Operations

```csharp
// Dependency injection setup
services.AddDbContext<SsrDbContext>(options =>
    options.UseSqlServer(configuration.GetConnectionString("SanSabaConnection")));

services.AddScoped<UserRepository>();

// Usage
public class MyService
{
    private readonly UserRepository _userRepo;
    
    public MyService(UserRepository userRepo)
    {
        _userRepo = userRepo;
    }
    
    public async Task<User?> GetUserAsync(string userId)
    {
        return await _userRepo.LoadUserByUserIdAsync(userId);
    }
    
    public async Task<bool> AuthenticateAsync(string email, string password)
    {
        var user = await _userRepo.AuthenticateAndLoadAsync(email, password);
        return user != null;
    }
}
```

## ğŸ“ Next Steps

1. **Complete Entity Scaffolding**
   - Run `scaffold-database.sh` to generate all entities
   - Review generated code for accuracy
   - Add any custom logic or validation

2. **Convert Remaining Business Logic**
   - Create repositories for each entity type
   - Convert VB methods to async C# methods
   - Add unit tests

3. **Update Client Applications**
   - Reference the new .NET 8 assembly
   - Update method calls to use async/await
   - Handle nullable reference types

4. **Testing**
   - Write unit tests for repositories
   - Integration tests with actual database
   - Test password authentication compatibility

## ğŸ“š Resources

- [EF Core Documentation](https://learn.microsoft.com/en-us/ef/core/)
- [.NET 8 Migration Guide](https://learn.microsoft.com/en-us/dotnet/core/porting/)
- [Repository Pattern](https://learn.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design)
- [Async/Await Best Practices](https://learn.microsoft.com/en-us/archive/msdn-magazine/2013/march/async-await-best-practices-in-asynchronous-programming)

## âš ï¸ Known Issues & Considerations

- **Password Hashing**: Uses SHA1 by default for backward compatibility. Consider migrating to SHA256 for new passwords.
- **Connection String**: Update in `appsettings.json` before running.
- **Nullable Types**: Enabled by default - review generated entities for proper nullable annotations.
- **Breaking Changes**: This is not a drop-in replacement - client code will need updates.

## ğŸ¤ Contributing

When adding new repositories or entities:

1. Follow the established patterns (Repository<T> base class)
2. Use async/await for all database operations
3. Add XML documentation comments
4. Include proper error handling
5. Write unit tests

---

**Migration Date**: December 2024  
**Target Framework**: .NET 10.0 (LTS)  
**Original Project**: SSRBusiness (VB.NET .NET Framework 4.8)
